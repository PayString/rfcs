<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Draft 1 - PayID Easy Checkout Protocol</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Terminology">
<link href="#rfc.section.2" rel="Chapter" title="2 Introduction">
<link href="#rfc.section.3" rel="Chapter" title="3 PayID Easy Checkout Protocol">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 PayID Easy Checkout Discovery">
<link href="#rfc.section.3.1.1" rel="Chapter" title="3.1.1 Step 1: Assemble PayID Easy Checkout Discovery URL">
<link href="#rfc.section.3.1.2" rel="Chapter" title="3.1.2 Step 2: Query PayID Discovery URL">
<link href="#rfc.section.3.1.3" rel="Chapter" title="3.1.3 Step 3: Parse PayID Easy Checkout Metadata">
<link href="#rfc.section.3.1.4" rel="Chapter" title="3.1.4 Template Syntax">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 PayID Easy Checkout URL Assembly">
<link href="#rfc.section.4" rel="Chapter" title="4 PayID Easy Checkout JRDs">
<link href="#rfc.section.5" rel="Chapter" title="5 Security Considerations">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 PayID Easy Checkout Redirection URI Manipulation">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 Access Control">
<link href="#rfc.section.6" rel="Chapter" title="6 IANA Considerations">
<link href="#rfc.section.7" rel="Chapter" title="7 Acknowledgments">
<link href="#rfc.section.8" rel="Chapter" title="8 Appendix">
<link href="#rfc.section.8.1" rel="Chapter" title="8.1 Motivation">
<link href="#rfc.section.8.1.1" rel="Chapter" title="8.1.1 Design Goals">
<link href="#rfc.section.8.2" rel="Chapter" title="8.2 Example Usage">
<link href="#rfc.section.8.2.1" rel="Chapter" title="8.2.1 PayID Easy Checkout Initiation">
<link href="#rfc.section.8.2.2" rel="Chapter" title="8.2.2 PayID Easy Checkout Wallet Discovery">
<link href="#rfc.section.8.2.3" rel="Chapter" title="8.2.3 Expand Wallet Discovery URL Template">
<link href="#rfc.section.8.2.4" rel="Chapter" title="8.2.4 Redirect Customer to Their Wallet">
<link href="#rfc.section.8.2.5" rel="Chapter" title="8.2.5 Customer Confirms Payment">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.46.0 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Kramer, N. and I. Simpson" />
  <meta name="dct.identifier" content="urn:ietf:id:payid-easy-checkout-protocol" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-07-20" />
  <meta name="dct.abstract" content="This specification formalizes how a payment recipient, such as a merchant or a non-profit, can automatically initiate a payment from a customer using only the customer&#x27;s PayID. " />
  <meta name="description" content="This specification formalizes how a payment recipient, such as a merchant or a non-profit, can automatically initiate a payment from a customer using only the customer&#x27;s PayID. " />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">N. Kramer</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">I. Simpson</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">Ripple</td>
</tr>
<tr>
<td class="left">Expires: January 21, 2021</td>
<td class="right">July 20, 2020</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Draft 1 - PayID Easy Checkout Protocol<br />
  <span class="filename">payid-easy-checkout-protocol</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification formalizes how a payment recipient, such as a merchant or a non-profit, can automatically initiate a payment from a customer using only the customer's PayID.</p>
<h1><a>Feedback</a></h1>
<p>This specification is a draft proposal, and is part of the <a href="https://payid.org/">PayID Protocol</a> initiative. Feedback related to this document should be sent in the form of a Github issue at: https://github.com/payid-org/rfcs/issues.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on January 21, 2021.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Terminology</a>
</li>
<li>2.   <a href="#rfc.section.2">Introduction</a>
</li>
<li>3.   <a href="#rfc.section.3">PayID Easy Checkout Protocol</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">PayID Easy Checkout Discovery</a>
</li>
<ul><li>3.1.1.   <a href="#rfc.section.3.1.1">Step 1: Assemble PayID Easy Checkout Discovery URL</a>
</li>
<li>3.1.2.   <a href="#rfc.section.3.1.2">Step 2: Query PayID Discovery URL</a>
</li>
<li>3.1.3.   <a href="#rfc.section.3.1.3">Step 3: Parse PayID Easy Checkout Metadata</a>
</li>
<li>3.1.4.   <a href="#rfc.section.3.1.4">Template Syntax</a>
</li>
</ul><li>3.2.   <a href="#rfc.section.3.2">PayID Easy Checkout URL Assembly</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">PayID Easy Checkout JRDs</a>
</li>
<li>5.   <a href="#rfc.section.5">Security Considerations</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">PayID Easy Checkout Redirection URI Manipulation</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">Access Control</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">IANA Considerations</a>
</li>
<li>7.   <a href="#rfc.section.7">Acknowledgments</a>
</li>
<li>8.   <a href="#rfc.section.8">Appendix</a>
</li>
<ul><li>8.1.   <a href="#rfc.section.8.1">Motivation</a>
</li>
<ul><li>8.1.1.   <a href="#rfc.section.8.1.1">Design Goals</a>
</li>
</ul><li>8.2.   <a href="#rfc.section.8.2">Example Usage</a>
</li>
<ul><li>8.2.1.   <a href="#rfc.section.8.2.1">PayID Easy Checkout Initiation</a>
</li>
<li>8.2.2.   <a href="#rfc.section.8.2.2">PayID Easy Checkout Wallet Discovery</a>
</li>
<li>8.2.3.   <a href="#rfc.section.8.2.3">Expand Wallet Discovery URL Template</a>
</li>
<li>8.2.4.   <a href="#rfc.section.8.2.4">Redirect Customer to Their Wallet</a>
</li>
<li>8.2.5.   <a href="#rfc.section.8.2.5">Customer Confirms Payment</a>
</li>
</ul></ul><li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Authors' Addresses</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.1.p.1">This protocol can be referred to as the <samp>PayId Easy Checkout Protocol</samp>. It uses the following terminology:</p>
<p></p>

<ul>
<li>PayID client: a client that queries a PayID server using the PayID Protocol as defined in [PAYID-PROTOCOL][].</li>
<li>PayID server: the endpoint that returns payment account(s) information, which conforms to the PayID Protocol.</li>
<li>merchant: individual or entity receiving the payment (ie e-commerce merchant, charity).</li>
<li>customer: individual or entity originating the payment to the <samp>merchant</samp>.</li>
<li>wallet: the holder of funds for the <samp>sender</samp> (may or may not be custodied).</li>
<li>Redirect URL: The URL that is the result of the PayID Easy Checkout protocol, and which can be used to redirect a client to a wallet corresponding to a particular PayID.</li>
</ul>
<p id="rfc.section.1.p.3">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a> and [RFC9174][].</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.2.p.1">The PayID Easy Checkout Protocol is a minimal protocol designed to provide a standard method for online merchants to request a payment from a customer using only the customer's PayID. Implementations of the protocol should require little to no server-side engineering efforts, while creating an improved and uniform user experience for customers.</p>
<p id="rfc.section.2.p.2">The main focus of the Protocol is on PayID Easy Checkout Discovery, which defines how a PayID client can use a PayID to retrieve a PayID Easy Checkout URI Template which, when expanded, constitutes a PayID Easy Checkout URL representing a resource that the customer's digital wallet can use to initiate a payment to the merchant.</p>
<p id="rfc.section.2.p.3">Though section (TODO: link to appendix example usage section) of this specification provides an example usage of a PayID Easy Checkout URL using Web Redirects, supplemental RFCs are needed to define the different ways in which a PayID client can utilize a PayID Easy Checkout URL.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#payid-easy-checkout-protocol" id="payid-easy-checkout-protocol">PayID Easy Checkout Protocol</a>
</h1>
<p id="rfc.section.3.p.1">The PayID Easy Checkout Protocol can be used to facilitate an end-to-end checkout flow between a recipient client, such as an online merchant UI, and a wallet client.</p>
<p id="rfc.section.3.p.2">The protocol is comprised of two parts:</p>
<p></p>

<ol>
<li>PayID Easy Checkout Discovery</li>
<li>Assembly of PayID Easy Checkout URL</li>
</ol>
<p id="rfc.section.3.p.4">The result of the protocol is a URL, which can be used by clients to complete a payment with minimal user interaction.  However, the PayID Easy Checkout protocol does not define how a PayID Easy Checkout URL can or should be used. Instead, we defer those specifications to future RFCs.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#payid-easy-checkout-discovery" id="payid-easy-checkout-discovery">PayID Easy Checkout Discovery</a>
</h1>
<p id="rfc.section.3.1.p.1">PayID Easy Checkout extends <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a> by defining a new link in the PayID metadata JRD returned by a PayID Discovery query. This link, defined in section (TODO: link to jrd section) of this specification, includes the PayID Easy Checkout URI Template representing a resource on the wallet which can be used to complete a payment.</p>
<p id="rfc.section.3.1.p.2">E-commerce receivers who wish to perform Easy Checkout MUST query the PayID Discovery server to obtain a PayID Easy Checkout URI Template. Digital wallets and PayID server operators who wish to enable PayID Easy Checkout MUST include a JRD Link conforming to the definition in section (TODO: link to jrd section) of this paper in all PayID Easy Checkout Discovery responses.</p>
<p id="rfc.section.3.1.p.3">E-commerce receivers SHOULD implement fallback measures to complete checkout if a user's wallet does not support PayID Easy Checkout.</p>
<p id="rfc.section.3.1.p.4">The following steps describe how a PayID client can query a PayID server to obtain a PayID Easy Checkout URI Template.</p>
<h1 id="rfc.section.3.1.1">
<a href="#rfc.section.3.1.1">3.1.1.</a> <a href="#step-1-assemble-payid-easy-checkout-discovery-url" id="step-1-assemble-payid-easy-checkout-discovery-url">Step 1: Assemble PayID Easy Checkout Discovery URL</a>
</h1>
<p id="rfc.section.3.1.1.p.1">The process of assembling a PayID Discovery URL is defined in section 4.1.1 of <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a>, and is the same as for PayID Easy Checkout Discovery.</p>
<h1 id="rfc.section.3.1.2">
<a href="#rfc.section.3.1.2">3.1.2.</a> <a href="#step-2-query-payid-discovery-url" id="step-2-query-payid-discovery-url">Step 2: Query PayID Discovery URL</a>
</h1>
<p id="rfc.section.3.1.2.p.1">A Webfinger query MUST be performed against the PayID Discovery URL assembled in the previous section, as described in section 4.2 of Webfinger.</p>
<p id="rfc.section.3.1.2.p.2">In response, the WebFinger resource returns a JSON Resource Descriptor (JRD) as the resource representation to convey information about the requested PayID.</p>
<p id="rfc.section.3.1.2.p.3">If the Webfinger endpoint returns a non-200 HTTP response status code, then PayID Easy Checkout is considered to have failed. Clients SHOULD implement fallback measures to complete checkout in this case.</p>
<h1 id="rfc.section.3.1.3">
<a href="#rfc.section.3.1.3">3.1.3.</a> <a href="#step-3-parse-payid-easy-checkout-metadata" id="step-3-parse-payid-easy-checkout-metadata">Step 3: Parse PayID Easy Checkout Metadata</a>
</h1>
<p id="rfc.section.3.1.3.p.1">If a wallet supports PayID Easy Checkout, the PayID server MUST respond with a HTTP status code 200 and a JSON payload containing a JSON Resource Descriptor (JRD) as defined in section (TODO: link to jrd section) of this document.  The JRD MUST contain a link conforming to the link definition in section (TODO: link to section) of this paper.</p>
<p id="rfc.section.3.1.3.p.2">For example, a PayID server might respond to a PayID Easy Checkout Discovery query with the following payload:</p>
<pre>
 {
    "subject": "payid:alice$wallet.com",
    "links": [
        {
            "rel" : "https://payid.org/ns/payid-easy-checkout/1.0",
            "template": "https://wallet.com/checkout?amount={amount}&amp;receiverPayId={receiverPayId}&amp;currency={currency}&amp;nextUrl={nextUrl}"
        }
    ]
 }
</pre>
<p id="rfc.section.3.1.3.p.3">The receiver client must parse this response to find the PayID Easy Checkout Link.  If the JRD returned from the PayID Easy Checkout Discovery query does not contain a PayID Easy Checkout Link in its 'links' collection, PayID Easy Checkout is considered to have failed.  Once a PayID Easy Checkout URI Template has been obtained from the PayID Easy Checkout Link by the PayID client, PayID Easy Checkout Discovery is considered to be complete.</p>
<h1 id="rfc.section.3.1.4">
<a href="#rfc.section.3.1.4">3.1.4.</a> <a href="#template-syntax" id="template-syntax">Template Syntax</a>
</h1>
<p id="rfc.section.3.1.4.p.1">This specification defines a simple template syntax for PayID Easy Checkout URI Template transformation.  A template is a string containing brace-enclosed ("{}") variable names marking the parts of the string that are to be substituted by the corresponding variable values.</p>
<p id="rfc.section.3.1.4.p.2">This specification defines several variables, which MAY or MAY NOT be present in every PayID Easy Checkout URI Template.  These variables are as follows:</p>
<pre>
'amount': The amount that should be sent by the sender to the receiver
'receiverPayID': The PayID URI of the receiver
'currency': The ISO-4217 currency code that the sender should send
'network': The network that the sender should send payment over (TODO: define network enum or use rfc)
'nextURL': A URL that the sender's wallet can use after completing the payment
</pre>
<p id="rfc.section.3.1.4.p.3">When substituting values into a URI 'path' or 'query' part as defined by [RFC3986][], values with characters outside the character set allowed by paths or query parameters in [RFC3986][], respectively, MUST be percent or otherwise encoded.</p>
<p id="rfc.section.3.1.4.p.4">Protocols MAY define additional variables and syntax rules, but MUST NOT change the meaning of the variables specified in this document. If a client is unable to successfully process a template (e.g., unknown variable names, unknown or incompatible syntax), the link SHOULD be ignored.</p>
<p id="rfc.section.3.1.4.p.5">The template syntax ABNF is as follows:</p>
<pre>
uri-char     =  ( reserved / unreserved / pct-encoded )
var-char     =  ALPHA / DIGIT / "." / "_"
var-name     =  %x61.63.63.74.70.61.72.74 / ( 1*var-char )
variable     =  "{" var-name "}"
PAYID-EASY-CHECKOUT-URI-Template =  *( uri-char / variable )
</pre>
<p id="rfc.section.3.1.4.p.6">For example:</p>
<pre>
Input:    alice$wallet.com
          amount = 10
          receiverPayID=pay$merchant.com
          currency=XRP
          network=XRPL
          nextUrl=https://merchant.com/thankyou
Template: https://wallet.com/checkout?amount={amount}&amp;receiverPayId={receiverPayID}&amp;currency={currency}&amp;network={network}&amp;nextUrl={nextURL}
Output:   https://wallet.com/checkout?amount=10&amp;receiverPayId=payid%2Apay%24merchant.com&amp;currency=XRP&amp;network=XRPL&amp;nextUrl=https://merchant.com/thankyou
</pre>
<p id="rfc.section.3.1.4.p.7">TODO: Should we define acceptable URL template variable values for the redirect?</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#payid-easy-checkout-url-assembly" id="payid-easy-checkout-url-assembly">PayID Easy Checkout URL Assembly</a>
</h1>
<p id="rfc.section.3.2.p.1">The PayID Easy Checkout URL is constructed by expanding the PayID Easy Checkout URI Template as defined in section 3 of <a href="#RFC6570" class="xref">[RFC6570]</a> buy applying values corresponding to the variables specified in section (TODO: link to template section) to the Template.</p>
<p id="rfc.section.3.2.p.2">The PayID Checkout URI template MAY not contain the complete set of variables specified in section (TODO link section) of this document.  However, PayID Easy Checkout clients MUST replace each variable present in the URI Template with a value.  PayID Easy Checkout clients MAY replace URI Template values with an empty string, however it is RECOMMENDED that each variable be replaced with a non-empty value.</p>
<p id="rfc.section.3.2.p.3">The result of expanding the PayID Easy Checkout URI Template is a PayID Easy Checkout URL.  This URL SHOULD represent a resource that the customer can use to complete a payment. As previously stated, the ways in which the customer and merchant use that resource is outside the scope of this protocol.  The PayID Easy Checkout URL SHOULD be parsed to retrieve the values set by the recipient client. It is RECOMMENDED that wallet UIs use these values to pre-populate a payment transaction.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#payid-easy-checkout-jrds" id="payid-easy-checkout-jrds">PayID Easy Checkout JRDs</a>
</h1>
<p id="rfc.section.4.p.1">This section defines the PayID Easy Checkout Link, which conforms to section 4.4 of the Webfinger RFC.  In order for a PayID server to enable PayID Easy Checkout, a PayID Discovery query to the server MUST return a JRD containing a PayID Easy Checkout Link.</p>
<p id="rfc.section.4.p.2">The Link MUST include the Link Relation Type of section (TODO: link to link type section) in the object's 'rel' field.  The Link MUST also include a PayID Easy Checkout URI Template in the 'template' field of the link.</p>
<pre>
* 'rel': `https://payid.org/ns/payid-easy-checkout-uri/1.0`
* 'template': A PayID Easy Checkout URI Template
</pre>
<p id="rfc.section.4.p.3">The following is an example of a PayID Easy Checkout Link that indicates a PayID Easy Checkout URI Template:</p>
<pre>
{
    "rel": "https://payid.org/ns/payid-easy-checkout-uri/1.0",
    "template": https://wallet.com/checkout?amount={amount}&amp;receiverPayId={receiverPayID}&amp;currency={currency}&amp;network={network}&amp;nextUrl={nextURL}
}
</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.5.p.1">Various security considerations should be taken into account for PayID Easy Checkout.</p>
<p id="rfc.section.5.p.2">The security considerations for PayID Easy Checkout Discovery are discussed in section 6 of <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a>.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#payid-easy-checkout-redirection-uri-manipulation" id="payid-easy-checkout-redirection-uri-manipulation">PayID Easy Checkout Redirection URI Manipulation</a>
</h1>
<p id="rfc.section.5.1.p.1">When a customer uses the resource located at the PayID Easy Checkout URL, a hijacker could manipulate the data encoded in the URL to trick the sender into sending a payment to a different PayID than was originally requested, or manipulate other points of PayID Easy Checkout data to trick the sender.</p>
<p id="rfc.section.5.1.p.2">Additionally, if a hijacker gained access to the merchant client, they could replace the PayID Easy Checkout URI Template for the purposes of a phishing attack.</p>
<p id="rfc.section.5.1.p.3">Current work on the PayID Protocol and its extensions may prove useful in mitigating these risks.</p>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#access-control" id="access-control">Access Control</a>
</h1>
<p id="rfc.section.5.2.p.1">As with all web resources, access to the PayID Discovery resource could require authentication. See section 6 of [RFC7033][] for Access Control considerations.</p>
<p id="rfc.section.5.2.p.2">Furthermore, it is RECOMMENDED that PayID servers only expose PayID Easy Checkout URI Templates which resolve to a protected resource.</p>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<p id="rfc.section.6.p.1">## New Link Relation Types This document defines the following Link relation type per [RFC7033][].  See section 3 for examples of each type of Link.</p>
<p id="rfc.section.6.p.2">### PayID Discovery URI Template</p>
<pre>
* Relation Type ('rel'): `https://payid.org/ns/payid-easy-checkout-uri/1.0`
* Media Type: `application/jrd+json`
* Description: PayID Discovery URI Template, version 1.0
</pre>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#appendix" id="appendix">Appendix</a>
</h1>
<h1 id="rfc.section.8.1">
<a href="#rfc.section.8.1">8.1.</a> <a href="#motivation" id="motivation">Motivation</a>
</h1>
<p id="rfc.section.8.1.p.1">The PayID Easy Checkout Protocol aims to enable a consistent user experience for customers paying for goods in an e-commerce by standardizing the interaction between merchants and customer wallets.  Given the ability to assign arbitrary metadata to a PayID as defined in <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a>, there is an opportunity to standardize the set of interactions between merchant and customer, specifically the process by which a merchant directs a customer to their digital wallet to complete a payment.  We believe this protocol will enable an improved paying experience by reducing the number of steps a customer must take to complete a transaction and creating a consistent and familiar checkout pattern for customers.</p>
<p id="rfc.section.8.1.p.2">The second priority of PayID Easy Checkout is to limit the engineering effort needed to implement the protocol.  Clients wishing to adopt this pattern should only need to implement UI-level changes in order to make the flow function as intended, which may aid in expanding overall adoption, further enhancing the protocol's user experience benefits.</p>
<h1 id="rfc.section.8.1.1">
<a href="#rfc.section.8.1.1">8.1.1.</a> <a href="#design-goals" id="design-goals">Design Goals</a>
</h1>
<h1 id="rfc.section.8.1.1.1">
<a href="#rfc.section.8.1.1.1">8.1.1.1.</a> <a href="#minimal-effort-for-the-customer" id="minimal-effort-for-the-customer">Minimal effort for the customer</a>
</h1>
<p id="rfc.section.8.1.1.1.p.1">In order for a customer to checkout using the PayID Easy Checkout protocol, the customer only needs to provide a merchant with their PayID Easy Checkout enabled PayID.</p>
<h1 id="rfc.section.8.1.1.2">
<a href="#rfc.section.8.1.1.2">8.1.1.2.</a> <a href="#no-server-side-software-not-already-covered-by-the-payid-protocol" id="no-server-side-software-not-already-covered-by-the-payid-protocol">No server-side software not already covered by the PayID Protocol</a>
</h1>
<p id="rfc.section.8.1.1.2.p.1">Because the flow of PayID Easy Checkout is predicated on using the PayID Discovery Protocol and then redirecting the customer away from the merchant, all of the flow can be instrumented on the front end and doesn't require server-side resources.</p>
<p id="rfc.section.8.1.1.2.p.2">Apart from a PayID Discovery compliant PayID Server, The PayID Easy Checkout Protocol does not require server-side software to be run by either the customer or merchant for a payment. The PayID server is capable of providing details of where to send the customer via the PayID Discovery Protocol. Assuming the wallet used by the customer has implemented support in their UI for the PayID Easy Checkout Protocol, the customer can be redirected to their wallet to complete their transaction.</p>
<h1 id="rfc.section.8.2">
<a href="#rfc.section.8.2">8.2.</a> <a href="#example-usage" id="example-usage">Example Usage</a>
</h1>
<p id="rfc.section.8.2.p.1">This section shows a non-normative example of PayID Easy Checkout between a hypothetical merchant and customer. The merchant accepts payments using the PayID pay$merchant.com, and the customer controls the PayID alice$wallet.com.</p>
<h1 id="rfc.section.8.2.1">
<a href="#rfc.section.8.2.1">8.2.1.</a> <a href="#payid-easy-checkout-initiation" id="payid-easy-checkout-initiation">PayID Easy Checkout Initiation</a>
</h1>
<p id="rfc.section.8.2.1.p.1">In this example, the customer might place some items in an online shopping cart on the merchant's UI, then choose to checkout.  The merchant UI would then render a form asking for the customer's PayID, as well as a "Checkout with PayID" button.  Once the customer inputs their PayID alice$wallet.com and clicks the "Checkout with PayID" button, the merchant UI begins the PayID Easy Checkout flow.</p>
<h1 id="rfc.section.8.2.2">
<a href="#rfc.section.8.2.2">8.2.2.</a> <a href="#payid-easy-checkout-wallet-discovery" id="payid-easy-checkout-wallet-discovery">PayID Easy Checkout Wallet Discovery</a>
</h1>
<p id="rfc.section.8.2.2.p.1">The merchant UI would first assemble the PayID Discovery URL as defined in section 4.1.1 of <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a>, yielding the URL <samp>https://wallet.com/.well-known/webfinger?resource=payid%3Aalice%24wallet.com</samp>.  The merchant UI would then query the assembled URL as defined in section 4.1.2 of <a href="#PAYID-DISCOVERY" class="xref">[PAYID-DISCOVERY]</a>.</p>
<p id="rfc.section.8.2.2.p.2">The HTTP request in this example would look like this:</p>
<pre>
GET /.well-known/webfinger?resource=payid%3Aalice%24wallet.com
Host: wallet.com
</pre>
<p id="rfc.section.8.2.2.p.3">If the customer's PayID server has enabled PayID Easy Checkout in their wallet, the server would respond with something like this:</p>
<pre>
 HTTP/1.1 200 OK
 Access-Control-Allow-Origin: *
 Content-Type: application/jrd+json

 {
   "subject" : "payid:alice$wallet.com",
   "links" :
   [
     {  
       "rel": "https://payid.org/ns/payid-easy-checkout/1.0",
       "template": "https://wallet.com/checkout?amount={amount}&amp;receiverPayId={receiverPayId}&amp;currency={currency}&amp;nextUrl={nextUrl}"
     }
   ]
 }
</pre>
<h1 id="rfc.section.8.2.3">
<a href="#rfc.section.8.2.3">8.2.3.</a> <a href="#expand-wallet-discovery-url-template" id="expand-wallet-discovery-url-template">Expand Wallet Discovery URL Template</a>
</h1>
<p id="rfc.section.8.2.3.p.1">The merchant UI would parse the PayID Discovery response and iterate over the "links" collection to find the link with the Relation Type of "https://payid.org/ns/payid-easy-checkout/1.0". The UI can then do a search and replace on the "template" field value in the link, replacing all occurrences of the predefined query parameter template names with the values they want to send to the customer's wallet. One query parameter of note is the "nextUrl" parameter, which allows the merchant to supply a redirect or callback URL for the sender's wallet to call once the customer has confirmed the payment. In this example, the merchant would like to display a "Thank You" page, and replaces <samp>{nextUrl}</samp> with <samp>https://merchant.com/thankyou</samp>.</p>
<h1 id="rfc.section.8.2.4">
<a href="#rfc.section.8.2.4">8.2.4.</a> <a href="#redirect-customer-to-their-wallet" id="redirect-customer-to-their-wallet">Redirect Customer to Their Wallet</a>
</h1>
<p id="rfc.section.8.2.4.p.1">Once the merchant UI populates the required query parameters in the URL template, the merchant UI redirects the customer to the Redirect URL so that the customer can confirm the payment.</p>
<h1 id="rfc.section.8.2.5">
<a href="#rfc.section.8.2.5">8.2.5.</a> <a href="#customer-confirms-payment" id="customer-confirms-payment">Customer Confirms Payment</a>
</h1>
<p id="rfc.section.8.2.5.p.1">After the customer clicks the "Pay with PayID" button the merchant's UI, and the merchant performs the previous steps, the customer will be redirected to the Redirect URL, which is a front end resource of the wallet. The wallet UI can read the query parameters from the Redirect URL and render a confirmation page or modal with all of the required fields pre-populated.</p>
<p id="rfc.section.8.2.5.p.2">Once the customer confirms the payment, the wallet would perform a PayID address lookup on the "receiverPayId" query parameter to get the payment address of the merchant and submit a transaction to the underlying ledger or payment system.  The merchant can then redirect the user back to the URL specified in the "nextUrl" query parameter, which will display the "Thank You" page of the merchant.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="PAYID-DISCOVERY">[PAYID-DISCOVERY]</b></td>
<td class="top">
<a>Fuelling, D.</a>, "<a>PayID Discovery</a>", n.d..</td>
</tr>
<tr>
<td class="reference"><b id="PAYID-URI">[PAYID-URI]</b></td>
<td class="top">
<a>Fuelling, D.</a>, "<a href="https://tbd.example.com/">The 'payid' URI Scheme</a>", n.d..</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC2818">[RFC2818]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/rfc2818">HTTP Over TLS</a>", RFC 2818, DOI 10.17487/RFC2818, May 2000.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6265">[RFC6265]</b></td>
<td class="top">
<a>Barth, A.</a>, "<a href="https://tools.ietf.org/html/rfc6265">HTTP State Management Mechanism</a>", RFC 6265, DOI 10.17487/RFC6265, April 2011.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6570">[RFC6570]</b></td>
<td class="top">
<a>Gregorio, J.</a>, <a>Fielding, R.</a>, <a>Hadley, M.</a>, <a>Nottingham, M.</a> and <a>D. Orchard</a>, "<a href="https://tools.ietf.org/html/rfc6570">URI Template</a>", RFC 6570, DOI 10.17487/RFC6570, March 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7231">[RFC7231]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7231">Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</a>", RFC 7231, DOI 10.17487/RFC7231, June 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7413">[RFC7413]</b></td>
<td class="top">
<a>Cheng, Y.</a>, <a>Chu, J.</a>, <a>Radhakrishnan, S.</a> and <a>A. Jain</a>, "<a href="https://tools.ietf.org/html/rfc7413">TCP Fast Open</a>", RFC 7413, DOI 10.17487/RFC7413, December 2014.</td>
</tr>
<tr>
<td class="reference"><b id="RFC8446">[RFC8446]</b></td>
<td class="top">
<a>Rescorla, E.</a>, "<a href="https://tools.ietf.org/html/rfc8446">The Transport Layer Security (TLS) Protocol Version 1.3</a>", RFC 8446, DOI 10.17487/RFC8446, August 2018.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody><tr>
<td class="reference"><b id="RFC5988">[RFC5988]</b></td>
<td class="top">
<a>Nottingham, M.</a>, "<a href="https://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, DOI 10.17487/RFC5988, October 2010.</td>
</tr></tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Noah Kramer</span> 
	  <span class="n hidden">
		<span class="family-name">Kramer</span>
	  </span>
	</span>
	<span class="org vcardline">Ripple</span>
	<span class="adr">
	  <span class="vcardline">315 Montgomery Street</span>

	  <span class="vcardline">
		<span class="locality">San Francisco</span>,  
		<span class="region">CA</span> 
		<span class="code">94104</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: -----------------</span>

<span class="vcardline">EMail: <a href="mailto:nkramer@ripple.com">nkramer@ripple.com</a></span>

<span class="vcardline">URI: <a href="https://www.ripple.com">https://www.ripple.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Ian Simpson</span> 
	  <span class="n hidden">
		<span class="family-name">Simpson</span>
	  </span>
	</span>
	<span class="org vcardline">Ripple</span>
	<span class="adr">
	  <span class="vcardline">315 Montgomery Street</span>

	  <span class="vcardline">
		<span class="locality">San Francisco</span>,  
		<span class="region">CA</span> 
		<span class="code">94104</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: -----------------</span>

<span class="vcardline">EMail: <a href="mailto:isimpson@ripple.com">isimpson@ripple.com</a></span>

<span class="vcardline">URI: <a href="https://www.ripple.com">https://www.ripple.com</a></span>

  </address>
</div>

</body>
</html>
