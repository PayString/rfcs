<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>PayID Discovery</title>

  <style type="text/css" title="Xml2Rfc (sans serif)">
  /*<![CDATA[*/
	  a {
	  text-decoration: none;
	  }
      /* info code from SantaKlauss at http://www.madaboutstyle.com/tooltip2.html */
      a.info {
          /* This is the key. */
          position: relative;
          z-index: 24;
          text-decoration: none;
      }
      a.info:hover {
          z-index: 25;
          color: #FFF; background-color: #900;
      }
      a.info span { display: none; }
      a.info:hover span.info {
          /* The span will display just on :hover state. */
          display: block;
          position: absolute;
          font-size: smaller;
          top: 2em; left: -5em; width: 15em;
          padding: 2px; border: 1px solid #333;
          color: #900; background-color: #EEE;
          text-align: left;
      }
	  a.smpl {
	  color: black;
	  }
	  a:hover {
	  text-decoration: underline;
	  }
	  a:active {
	  text-decoration: underline;
	  }
	  address {
	  margin-top: 1em;
	  margin-left: 2em;
	  font-style: normal;
	  }
	  body {
	  color: black;
	  font-family: verdana, helvetica, arial, sans-serif;
	  font-size: 10pt;
	  max-width: 55em;
	  
	  }
	  cite {
	  font-style: normal;
	  }
	  dd {
	  margin-right: 2em;
	  }
	  dl {
	  margin-left: 2em;
	  }
	
	  ul.empty {
	  list-style-type: none;
	  }
	  ul.empty li {
	  margin-top: .5em;
	  }
	  dl p {
	  margin-left: 0em;
	  }
	  dt {
	  margin-top: .5em;
	  }
	  h1 {
	  font-size: 14pt;
	  line-height: 21pt;
	  page-break-after: avoid;
	  }
	  h1.np {
	  page-break-before: always;
	  }
	  h1 a {
	  color: #333333;
	  }
	  h2 {
	  font-size: 12pt;
	  line-height: 15pt;
	  page-break-after: avoid;
	  }
	  h3, h4, h5, h6 {
	  font-size: 10pt;
	  page-break-after: avoid;
	  }
	  h2 a, h3 a, h4 a, h5 a, h6 a {
	  color: black;
	  }
	  img {
	  margin-left: 3em;
	  }
	  li {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  ol p {
	  margin-left: 0em;
	  }
	  p {
	  margin-left: 2em;
	  margin-right: 2em;
	  }
	  pre {
	  margin-left: 3em;
	  background-color: lightyellow;
	  padding: .25em;
	  }
	  pre.text2 {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f0f0f0;
	  width: 69em;
	  }
	  pre.inline {
	  background-color: white;
	  padding: 0em;
	  }
	  pre.text {
	  border-style: dotted;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  width: 69em;
	  }
	  pre.drawing {
	  border-style: solid;
	  border-width: 1px;
	  background-color: #f8f8f8;
	  padding: 2em;
	  }
	  table {
	  margin-left: 2em;
	  }
	  table.tt {
	  vertical-align: top;
	  }
	  table.full {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.headers {
	  border-style: outset;
	  border-width: 1px;
	  }
	  table.tt td {
	  vertical-align: top;
	  }
	  table.full td {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.tt th {
	  vertical-align: top;
	  }
	  table.full th {
	  border-style: inset;
	  border-width: 1px;
	  }
	  table.headers th {
	  border-style: none none inset none;
	  border-width: 1px;
	  }
	  table.left {
	  margin-right: auto;
	  }
	  table.right {
	  margin-left: auto;
	  }
	  table.center {
	  margin-left: auto;
	  margin-right: auto;
	  }
	  caption {
	  caption-side: bottom;
	  font-weight: bold;
	  font-size: 9pt;
	  margin-top: .5em;
	  }
	
	  table.header {
	  border-spacing: 1px;
	  width: 95%;
	  font-size: 10pt;
	  color: white;
	  }
	  td.top {
	  vertical-align: top;
	  }
	  td.topnowrap {
	  vertical-align: top;
	  white-space: nowrap; 
	  }
	  table.header td {
	  background-color: gray;
	  width: 50%;
	  }
	  table.header a {
	  color: white;
	  }
	  td.reference {
	  vertical-align: top;
	  white-space: nowrap;
	  padding-right: 1em;
	  }
	  thead {
	  display:table-header-group;
	  }
	  ul.toc, ul.toc ul {
	  list-style: none;
	  margin-left: 1.5em;
	  margin-right: 0em;
	  padding-left: 0em;
	  }
	  ul.toc li {
	  line-height: 150%;
	  font-weight: bold;
	  font-size: 10pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  ul.toc li li {
	  line-height: normal;
	  font-weight: normal;
	  font-size: 9pt;
	  margin-left: 0em;
	  margin-right: 0em;
	  }
	  li.excluded {
	  font-size: 0pt;
	  }
	  ul p {
	  margin-left: 0em;
	  }
	
	  .comment {
	  background-color: yellow;
	  }
	  .center {
	  text-align: center;
	  }
	  .error {
	  color: red;
	  font-style: italic;
	  font-weight: bold;
	  }
	  .figure {
	  font-weight: bold;
	  text-align: center;
	  font-size: 9pt;
	  }
	  .filename {
	  color: #333333;
	  font-weight: bold;
	  font-size: 12pt;
	  line-height: 21pt;
	  text-align: center;
	  }
	  .fn {
	  font-weight: bold;
	  }
	  .hidden {
	  display: none;
	  }
	  .left {
	  text-align: left;
	  }
	  .right {
	  text-align: right;
	  }
	  .title {
	  color: #990000;
	  font-size: 18pt;
	  line-height: 18pt;
	  font-weight: bold;
	  text-align: center;
	  margin-top: 36pt;
	  }
	  .vcardline {
	  display: block;
	  }
	  .warning {
	  font-size: 14pt;
	  background-color: yellow;
	  }
	
	
	  @media print {
	  .noprint {
		display: none;
	  }
	
	  a {
		color: black;
		text-decoration: none;
	  }
	
	  table.header {
		width: 90%;
	  }
	
	  td.header {
		width: 50%;
		color: black;
		background-color: white;
		vertical-align: top;
		font-size: 12pt;
	  }
	
	  ul.toc a::after {
		content: leader('.') target-counter(attr(href), page);
	  }
	
	  ul.ind li li a {
		content: target-counter(attr(href), page);
	  }
	
	  .print2col {
		column-count: 2;
		-moz-column-count: 2;
		column-fill: auto;
	  }
	  }
	
	  @page {
	  @top-left {
		   content: "Internet-Draft"; 
	  } 
	  @top-right {
		   content: "December 2010"; 
	  } 
	  @top-center {
		   content: "Abbreviated Title";
	  } 
	  @bottom-left {
		   content: "Doe"; 
	  } 
	  @bottom-center {
		   content: "Expires June 2011"; 
	  } 
	  @bottom-right {
		   content: "[Page " counter(page) "]"; 
	  } 
	  }
	
	  @page:first { 
		@top-left {
		  content: normal;
		}
		@top-right {
		  content: normal;
		}
		@top-center {
		  content: normal;
		}
	  }
  /*]]>*/
  </style>

  <link href="#rfc.toc" rel="Contents">
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction">
<link href="#rfc.section.2" rel="Chapter" title="2 Terminology">
<link href="#rfc.section.3" rel="Chapter" title="3 Example Usage">
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 PayID Discovery by a Wallet">
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 PayID Discovery with Default Template">
<link href="#rfc.section.4" rel="Chapter" title="4 PayID Discovery Protocol">
<link href="#rfc.section.4.1" rel="Chapter" title="4.1 Interactive Mode">
<link href="#rfc.section.4.1.1" rel="Chapter" title="4.1.1 Step 1: Assemble PayID Discovery URL">
<link href="#rfc.section.4.1.2" rel="Chapter" title="4.1.2 Step 2: Query PayID Discovery URL">
<link href="#rfc.section.4.1.3" rel="Chapter" title="4.1.3 Step 3: Parse PayID Metadata">
<link href="#rfc.section.4.1.4" rel="Chapter" title="4.1.4 Step 4: Assemble PayID URL">
<link href="#rfc.section.4.2" rel="Chapter" title="4.2 Fallback Mode">
<link href="#rfc.section.4.2.1" rel="Chapter" title="4.2.1 Fallback Assembly Flow">
<link href="#rfc.section.5" rel="Chapter" title="5 PayID Discovery JRDs">
<link href="#rfc.section.5.1" rel="Chapter" title="5.1 JRD for PayID Discovery URL">
<link href="#rfc.section.5.2" rel="Chapter" title="5.2 JRD for PayID URI Template">
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations">
<link href="#rfc.section.6.1" rel="Chapter" title="6.1 Hosted PayID Discovery Services">
<link href="#rfc.section.6.2" rel="Chapter" title="6.2 Cross-Origin Resource Sharing (CORS)">
<link href="#rfc.section.6.3" rel="Chapter" title="6.3 Access Control">
<link href="#rfc.section.7" rel="Chapter" title="7 IANA Considerations">
<link href="#rfc.section.7.1" rel="Chapter" title="7.1 New Link Relation Types">
<link href="#rfc.section.7.1.1" rel="Chapter" title="7.1.1 PayID Discovery URL">
<link href="#rfc.section.7.1.2" rel="Chapter" title="7.1.2 PayID Discovery URI Template">
<link href="#rfc.section.8" rel="Chapter" title="8 Acknowledgments">
<link href="#rfc.references" rel="Chapter" title="9 References">
<link href="#rfc.references.1" rel="Chapter" title="9.1 Normative References">
<link href="#rfc.references.2" rel="Chapter" title="9.2 Informative References">
<link href="#rfc.authors" rel="Chapter">


  <meta name="generator" content="xml2rfc version 2.10.3 - https://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Fuelling, D." />
  <meta name="dct.identifier" content="urn:ietf:id:draft-fuelling-payid-discovery-01" />
  <meta name="dct.issued" scheme="ISO8601" content="2020-06-16" />
  <meta name="dct.abstract" content="This specification defines the PayID Discovery protocol, which can be used to discover information about a 'payid' URI using standard HTTP methods." />
  <meta name="description" content="This specification defines the PayID Discovery protocol, which can be used to discover information about a 'payid' URI using standard HTTP methods." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
<td class="left">Network Working Group</td>
<td class="right">D. Fuelling</td>
</tr>
<tr>
<td class="left">Internet-Draft</td>
<td class="right">Ripple</td>
</tr>
<tr>
<td class="left">Intended status: Standards Track</td>
<td class="right">June 16, 2020</td>
</tr>
<tr>
<td class="left">Expires: December 18, 2020</td>
<td class="right"></td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">PayID Discovery<br />
  <span class="filename">draft-fuelling-payid-discovery-01</span></p>
  
  <h1 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h1>
<p>This specification defines the PayID Discovery protocol, which can be used to discover information about a 'payid' URI using standard HTTP methods.</p>
<p>The primary use-case of this protocol is to define how to transform a PayID URI into a URL that can be used with other protocols.</p>
<h1><a>Feedback</a></h1>
<p>This specification is a part of the <a href="https://payid.org/">PayID Protocol</a> work.  Feedback related to this specification should be sent to <a href="mailto:payid@ripple.com">payid@ripple.com</a>.</p>
<h1 id="rfc.status"><a href="#rfc.status">Status of This Memo</a></h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at https://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on December 18, 2020.</p>
<h1 id="rfc.copyrightnotice"><a href="#rfc.copyrightnotice">Copyright Notice</a></h1>
<p>Copyright (c) 2020 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (https://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a>
</li>
<li>2.   <a href="#rfc.section.2">Terminology</a>
</li>
<li>3.   <a href="#rfc.section.3">Example Usage</a>
</li>
<ul><li>3.1.   <a href="#rfc.section.3.1">PayID Discovery by a Wallet</a>
</li>
<li>3.2.   <a href="#rfc.section.3.2">PayID Discovery with Default Template</a>
</li>
</ul><li>4.   <a href="#rfc.section.4">PayID Discovery Protocol</a>
</li>
<ul><li>4.1.   <a href="#rfc.section.4.1">Interactive Mode</a>
</li>
<ul><li>4.1.1.   <a href="#rfc.section.4.1.1">Step 1: Assemble PayID Discovery URL</a>
</li>
<li>4.1.2.   <a href="#rfc.section.4.1.2">Step 2: Query PayID Discovery URL</a>
</li>
<li>4.1.3.   <a href="#rfc.section.4.1.3">Step 3: Parse PayID Metadata</a>
</li>
<li>4.1.4.   <a href="#rfc.section.4.1.4">Step 4: Assemble PayID URL</a>
</li>
</ul><li>4.2.   <a href="#rfc.section.4.2">Fallback Mode</a>
</li>
<ul><li>4.2.1.   <a href="#rfc.section.4.2.1">Fallback Assembly Flow</a>
</li>
</ul></ul><li>5.   <a href="#rfc.section.5">PayID Discovery JRDs</a>
</li>
<ul><li>5.1.   <a href="#rfc.section.5.1">JRD for PayID Discovery URL</a>
</li>
<li>5.2.   <a href="#rfc.section.5.2">JRD for PayID URI Template</a>
</li>
</ul><li>6.   <a href="#rfc.section.6">Security Considerations</a>
</li>
<ul><li>6.1.   <a href="#rfc.section.6.1">Hosted PayID Discovery Services</a>
</li>
<li>6.2.   <a href="#rfc.section.6.2">Cross-Origin Resource Sharing (CORS)</a>
</li>
<li>6.3.   <a href="#rfc.section.6.3">Access Control</a>
</li>
</ul><li>7.   <a href="#rfc.section.7">IANA Considerations</a>
</li>
<ul><li>7.1.   <a href="#rfc.section.7.1">New Link Relation Types</a>
</li>
<ul><li>7.1.1.   <a href="#rfc.section.7.1.1">PayID Discovery URL</a>
</li>
<li>7.1.2.   <a href="#rfc.section.7.1.2">PayID Discovery URI Template</a>
</li>
</ul></ul><li>8.   <a href="#rfc.section.8">Acknowledgments</a>
</li>
<li>9.   <a href="#rfc.references">References</a>
</li>
<ul><li>9.1.   <a href="#rfc.references.1">Normative References</a>
</li>
<li>9.2.   <a href="#rfc.references.2">Informative References</a>
</li>
</ul><li><a href="#rfc.authors">Author's Address</a>
</li>


  </ul>

  <h1 id="rfc.section.1">
<a href="#rfc.section.1">1.</a> <a href="#introduction" id="introduction">Introduction</a>
</h1>
<p id="rfc.section.1.p.1">PayID Discovery is used to transform a PayID URI <a href="#PAYID-URI" class="xref">[PAYID-URI]</a> into a URL (defined below as a PayID Discovery URL) that can then be used by higher-order protocols to discover metadata about a PayID-enabled service provider.</p>
<p id="rfc.section.1.p.2">This document specifies two modes of PayID discovery: one using Webfinger <a href="#RFC7033" class="xref">[RFC7033]</a> to resolve a corresponding PayID Discovery URL from a PayID using an interactive protocol. The second mode uses a manual mechanism to assemble a PayID Discovery URL from a PayID by-hand.</p>
<p id="rfc.section.1.p.3">In 'interactive' mode, a PayID can be presented to a Webfinger-enabled service endpoint that supports PayID Discovery. The resource returns a Webfinger-compliant JavaScript Object Notation (JSON) <a href="#RFC4627" class="xref">[RFC4627]</a> object that can be used to perform PayID Discovery as defined in section 4.1 of this document.</p>
<p id="rfc.section.1.p.4">As an alternative, "manual" mode MAY be used to decompose a PayID into a URL, without any intermediate server interaction by simply transposing portions of a PayID URI into a URL format. This procedure is defined in section 4.2 of this document.</p>
<p id="rfc.section.1.p.5">It should be noted that "manual" mode does not allow divergence between the string characters in a PayID URI and any corresponding PayID URL.  Interactive mode, on the other hand, does allow such divergence, and is thus more powerful. For example, in manual mode, the PayID 'alice$example.com' MUST always map to the URL 'https://example.com/alice', whereas in interactive mode that same PayID URI can map to any arbitrary URL structure determined by the service provider, such as 'https://example.com/users/alice'.</p>
<p id="rfc.section.1.p.6">Information returned via PayID Discovery might be used for direct human consumption (e.g., looking up someone's Bitcoin address), or it might be used by systems to help carry out some operation (e.g., facilitating, with additional security mechanisms, protocols to support compliance or other legal requirements necessary to facilitate a payment).</p>
<p id="rfc.section.1.p.7">The information returned via this protocol is intended to be static in nature. As such, PayID Discovery is not intended to be used to return dynamic information like a payment account balance or the current status of a payment account.</p>
<p id="rfc.section.1.p.8">PayID Discovery is designed to be used across many applications. Use of PayID Discovery is illustrated in the examples in Section 3 and described more formally in Section 4.</p>
<h1 id="rfc.section.2">
<a href="#rfc.section.2">2.</a> <a href="#terminology" id="terminology">Terminology</a>
</h1>
<p id="rfc.section.2.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119" class="xref">[RFC2119]</a>.</p>
<h1 id="rfc.section.3">
<a href="#rfc.section.3">3.</a> <a href="#example-usage" id="example-usage">Example Usage</a>
</h1>
<p id="rfc.section.3.p.1">This section shows sample uses of PayID Discovery in several hypothetical scenarios.</p>
<h1 id="rfc.section.3.1">
<a href="#rfc.section.3.1">3.1.</a> <a href="#payid-discovery-by-a-wallet" id="payid-discovery-by-a-wallet">PayID Discovery by a Wallet</a>
</h1>
<p id="rfc.section.3.1.p.1">Suppose Alice wishes to send a friend some XRP from a web-based wallet provider that Alice has an account on. Alice would log-in to the wallet provider and enter Bob's PayID (say, <samp>bob$receiver.example.com</samp>) into the wallet UI to start the payment.</p>
<p id="rfc.section.3.1.p.2">The Wallet application would first perform a WebFinger query looking for the PayID Discovery service provider, like this:</p>
<pre>
 GET /.well-known/webfinger?
       resource=payid%3Abob%24receiver.example.com
       HTTP/1.1
 Host: receiver.example.com
</pre>
<p id="rfc.section.3.1.p.3">The server might respond like this:</p>
<pre>
 HTTP/1.1 200 OK
 Access-Control-Allow-Origin: *
 Content-Type: application/jrd+json

 {
   "subject" : "payid:bob$receiver.example.com",
   "links" :
   [
     {  
       "rel": "https://payid.org/ns/payid-uri-template/1.0",
       "template": "https://receiver.example.com/users/{acctpart}"
     }
   ]
 }
</pre>
<p id="rfc.section.3.1.p.4">Alice's wallet then uses the URL template found in the <samp>template</samp> property to assemble the specified PayId URL, <samp>https://receiver.example.com/users/bob</samp>.</p>
<p id="rfc.section.3.1.p.5">Per <a href="#RFC7033" class="xref">[RFC7033]</a>, Webfinger requests can be filtered by using a "rel" parameter in the Webfinger request. Because support for the "rel" parameter is not required nor guaranteed, the client must not assume the "links" array will contain only the link relations related to PayID Discovery.</p>
<h1 id="rfc.section.3.2">
<a href="#rfc.section.3.2">3.2.</a> <a href="#payid-discovery-with-default-template" id="payid-discovery-with-default-template">PayID Discovery with Default Template</a>
</h1>
<p id="rfc.section.3.2.p.1">Suppose Alice, as in the example above, wishes to send a friend some XRP from a web-based wallet provider that Alice has an account on. However, in this example, let's assume that the PayID Alice is wanting to pay doesn't support "interactive" PayID discovery (i.e., the receiver's server doesn't support Webfinger).</p>
<p id="rfc.section.3.2.p.2">Alice would log-in to her wallet provider and enter Bob's PayID (say <samp>bob$receiver.example.com</samp>) to make a payment.</p>
<p id="rfc.section.3.2.p.3">The Wallet application would first attempt a WebFinger query as in the example above, like this:</p>
<pre>
  GET /.well-known/webfinger?
        resource=payid%3Abob%24receiver.example.com&amp;
        HTTP/1.1
  Host: receiver.example.com
</pre>
<p id="rfc.section.3.2.p.4">However, in this case the <samp>receiver.example.com</samp> server doesn't support "interactive" PayID Discovery, so the server responds like this:</p>
<pre>
  HTTP/1.1 404 NOT FOUND
</pre>
<p id="rfc.section.3.2.p.5">Because Alice's Wallet can utilize "manual" PayID Discovery, the wallet software merely transforms <samp>bob$receiever.example.com</samp> into the URL <samp>https://receiver.example.com/bob</samp>. Alice's wallet then uses that URL to continue making a PayID payment.</p>
<p id="rfc.section.3.2.p.6">It should be noted that "manual" mode does not allow the PayID URI to diverge from the underlying URL returned via PayID Discovery. Because of this, "interactive" PayID Discovery is generally preferred.</p>
<h1 id="rfc.section.4">
<a href="#rfc.section.4">4.</a> <a href="#payid-discovery-protocol" id="payid-discovery-protocol">PayID Discovery Protocol</a>
</h1>
<p id="rfc.section.4.p.1">The PayID Discovery protocol is used to request information about an entity identified by a PayID URI.</p>
<p id="rfc.section.4.p.2">When successful, PayID Discovery always yields a PayID URL, which is a URI as defined by <a href="#RFC3986" class="xref">[RFC3986]</a> using the 'https' scheme defined in section 2.7.2 <a href="#RFC7230" class="xref">[RFC7230]</a>. A PayID URL can be used for any purposes outside the scope of this document.</p>
<p id="rfc.section.4.p.3">PayID Discovery is performed using one of two modes: "interactive" or "manual." Clients MUST attempt "interactive" mode first. If that mode fails to yield a PayID URL, then "manual" mode MAY be used as an alternative discovery mechanism.</p>
<h1 id="rfc.section.4.1">
<a href="#rfc.section.4.1">4.1.</a> <a href="#interactive-mode" id="interactive-mode">Interactive Mode</a>
</h1>
<p id="rfc.section.4.1.p.1">Interactive PayID Discovery is broken up into a series of steps, each of which is defined in more detail below. The following is a visual representation of the protocol flow:</p>
<pre>
                    +--------------------------+                    
                    |        PayID URI         |                    
                    |    alice$example.com     |                    
                    +--------------------------+                    
                                  |                                 
                                  v                                 
                    +--------------------------+                    
                    |         Assemble         |                    
                    |   PayID Discovery URL    |                    
                    +--------------------------+                    
                                  |                                 
                                  v                                 
                    +--------------------------+                    
                    |          Query           |                    
              +-----|   PayID Discovery URL    |-----+              
              |     +--------------------------+     |              
              |                                  Success            
              |                                      |              
              |                                      v              
              |                        +---------------------------+
          Failure                      |   Parse PayID Metadata    |
              |                        +---------------------------+
              |                                      |              
              |                                      v              
              |                        +---------------------------+
              |                        | Select PayID URI Template |
              |                        +---------------------------+
              |                                      |              
              v                                      v              
+--------------------------+           +---------------------------+
|  Manual PayID Discovery  |           |    Assemble PayID URL     |
+--------------------------+           +---------------------------+
              |                                      |              
              +---------------------+----------------+              
                                    |                               
                                    v                               
                      +---------------------------+                 
                      |         PayID URL         |                 
                      | https://example.com/alice |                 
                      +---------------------------+                 
</pre>
<h1 id="rfc.section.4.1.1">
<a href="#rfc.section.4.1.1">4.1.1.</a> <a href="#step-1-assemble-payid-discovery-url" id="step-1-assemble-payid-discovery-url">Step 1: Assemble PayID Discovery URL</a>
</h1>
<p id="rfc.section.4.1.1.p.1">PayID Discovery utilizes the Webfinger <a href="#RFC7033" class="xref">[RFC7033]</a> specification in a narrowly defined profile.</p>
<p id="rfc.section.4.1.1.p.2">This document defines a PayID Discovery URL as being a Webfinger resource URI where the specified resource value is a valid PayID URI <a href="#PAYID-URI" class="xref">[PAYID-URI]</a>.</p>
<p id="rfc.section.4.1.1.p.3">For example, the PayID Discovery URL for alice$example.com is</p>
<pre>
 https://example.com/.well-known/webfinger?resource=payid%3Abob%24example.com
</pre>
<h1 id="rfc.section.4.1.2">
<a href="#rfc.section.4.1.2">4.1.2.</a> <a href="#step-2-query-payid-discovery-url" id="step-2-query-payid-discovery-url">Step 2: Query PayID Discovery URL</a>
</h1>
<p id="rfc.section.4.1.2.p.1">A Webfinger query MUST be performed against the PayID Disovery URL, as described in section 4.2 of Webfinger.</p>
<p id="rfc.section.4.1.2.p.2">In response, the WebFinger resource returns a JSON Resource Descriptor (JRD) as the resource representation to convey information about the requested PayID.</p>
<p id="rfc.section.4.1.2.p.3">If the Webfinger endpoint returns a non-200 HTTP response status code, then interactive PayID Discovery is considered to have failed. Clients MAY attempt to assemble a PayID URL using "manual" mode as defined in section 4.2.1 of this document.</p>
<h1 id="rfc.section.4.1.3">
<a href="#rfc.section.4.1.3">4.1.3.</a> <a href="#step-3-parse-payid-metadata" id="step-3-parse-payid-metadata">Step 3: Parse PayID Metadata</a>
</h1>
<p id="rfc.section.4.1.3.p.1">If the PayID Discovery server returns a valid response, the response will contain one or more of the JRDs defined in section 5 of this document.</p>
<p id="rfc.section.4.1.3.p.2">If any of the JRDs contain a 'rel' value that represents a PayID URL Template, then that template value MUST be used in the next protocol step.</p>
<p id="rfc.section.4.1.3.p.3">Failing the above, if the 'rel' value of any JRDs represents a PayID Discovery URL, then that URL MUST be used in step 2 above, repeated recursively if needed, until a valid PayID URI Template is obtained.  That URI Template value MUST be used in the next protocol step.</p>
<h1 id="rfc.section.4.1.4">
<a href="#rfc.section.4.1.4">4.1.4.</a> <a href="#step-4-assemble-payid-url" id="step-4-assemble-payid-url">Step 4: Assemble PayID URL</a>
</h1>
<p id="rfc.section.4.1.4.p.1">A PayID URL is constructed by applying the PayID URI to the PayID URI Template string obtained in the step above. The PayID URI template MAY contain a URI string without any variables to represent a host-level PayID URL that is identical for every PayID URI on a particular host.</p>
<p id="rfc.section.4.1.4.p.2">For example, a PayID Discovery endpoint that only supports a single account might use a URI template string with no variables, like this:</p>
<pre>
{
  "rel": "https://payid.org/ns/payid-uri-template/1.0",
  "template": "https://example.com/alice"
}
</pre>
<p id="rfc.section.4.1.4.p.3">The result of this step is the PayID URL. Once obtained, PayID Discovery is considered to have completed successfully.</p>
<h1 id="rfc.section.4.1.4.1">
<a href="#rfc.section.4.1.4.1">4.1.4.1.</a> <a href="#template-syntax" id="template-syntax">Template Syntax</a>
</h1>
<p id="rfc.section.4.1.4.1.p.1">This specification defines a simple template syntax for PayID URI transformation.  A template is a string containing brace-enclosed ("{}") variable names marking the parts of the string that are to be substituted by the corresponding variable values.</p>
<p id="rfc.section.4.1.4.1.p.2">This specification defines a one variable &#8211; "acctpart" &#8211; which corresponds to the 'acctpart' of a PayID URI as defined in <a href="#PAYID-URI" class="xref">[PAYID-URI]</a>.</p>
<p id="rfc.section.4.1.4.1.p.3">When substituting the 'acctpart' value into a URI 'path' as defined by <a href="#RFC3986" class="xref">[RFC3986]</a>, values MUST NOT be percent or otherwise encoded because the 'acctpart' value of a PayID URI always conforms to the character set allowed by paths in <a href="#RFC3986" class="xref">[RFC3986]</a>.</p>
<p id="rfc.section.4.1.4.1.p.4">However, before substituting template variables into a URI 'query' part, values MUST be encoded using UTF-8, and any character other than unreserved (as defined by <a href="#RFC3986" class="xref">[RFC3986]</a>) MUST be percent-encoded per <a href="#RFC3986" class="xref">[RFC3986]</a>.</p>
<p id="rfc.section.4.1.4.1.p.5">Protocols MAY define additional variables and syntax rules, but MUST NOT change the meaning of the 'acctpart' variable. If a client is unable to successfully process a template (e.g., unknown variable names, unknown or incompatible syntax), the JRD SHOULD be ignored.</p>
<p id="rfc.section.4.1.4.1.p.6">The template syntax ABNF is as follows:</p>
<pre>
uri-char     =  ( reserved / unreserved / pct-encoded )
var-char     =  ALPHA / DIGIT / "." / "_"
var-name     =  %x61.63.63.74.70.61.72.74 / ( 1*var-char ) ; "acctpart" or
                                                              other names
variable     =  "{" var-name "}"
PAYID-URI-Template =  *( uri-char / variable )
</pre>
<p id="rfc.section.4.1.4.1.p.7">For example:</p>
<pre>
 Input:    alice$example.org
 Template: https://example.org/{acctpart}
 Output:   https://example.org/alice
</pre>
<h1 id="rfc.section.4.2">
<a href="#rfc.section.4.2">4.2.</a> <a href="#fallback-mode" id="fallback-mode">Fallback Mode</a>
</h1>
<p id="rfc.section.4.2.p.1">If "Interactive" mode is not supported or otherwise fails to yield a PayID URL, then a PayID URL MAY be assembled manually using the following predefined ruleset:</p>
<p></p>

<ol>
<li>Decompose the PayID URI into its component parts, per <a href="#PAYID-URI" class="xref">[PAYID-URI]</a>, capturing the 'acctpart' and 'host' values.</li>
<li>Using the 'acctpart' and 'host', assemble a URL by substituting each value into the following string using no special encoding or other character adjustments: <samp>https://{host}/{acctpart}</samp>.</li>
</ol>
<p id="rfc.section.4.2.p.3">For example:</p>
<pre>
 Input:    bob.primary$example.org
 Output:   https://example.org/bob.primary
</pre>
<p id="rfc.section.4.2.p.4">The resulting URL is a PayID URL.</p>
<h1 id="rfc.section.4.2.1">
<a href="#rfc.section.4.2.1">4.2.1.</a> <a href="#fallback-assembly-flow" id="fallback-assembly-flow">Fallback Assembly Flow</a>
</h1>
<p id="rfc.section.4.2.1.p.1">The following is a visual representation of the Fallback Assembly protocol flow:</p>
<pre>
+--------------------------+ 
|        PayID URI         | 
|    alice$example.com     | 
+--------------------------+ 
              |              
              v              
+--------------------------+ 
|Manual PayID URL Assembly | 
+--------------------------+ 
              |              
              v              
+---------------------------+
|         PayID URL         |
| https://example.com/alice |
+---------------------------+
</pre>
<h1 id="rfc.section.5">
<a href="#rfc.section.5">5.</a> <a href="#payid-discovery-jrds" id="payid-discovery-jrds">PayID Discovery JRDs</a>
</h1>
<p id="rfc.section.5.p.1">This document defines two JRDs that conform to section 4.4 of the Webfinger RFC.</p>
<h1 id="rfc.section.5.1">
<a href="#rfc.section.5.1">5.1.</a> <a href="#jrd-for-payid-discovery-url" id="jrd-for-payid-discovery-url">JRD for PayID Discovery URL</a>
</h1>
<p id="rfc.section.5.1.p.1">This type of JRD can be used to represent a URL that is a PayID Discovery URL. This is useful for delegating PayID Discovery to another service endpoint:</p>
<p></p>

<ul>
<li>'rel': <samp>https://payid.org/ns/payid-discovery-url/1.0</samp>
</li>
<li>'href': A PayID Discovery URL that clients can dereference to perform interactive PayID Discovery.</li>
</ul>
<p id="rfc.section.5.1.p.3">The following is an example of a JRD that indicates a PayID Discovery URL:</p>
<pre>
{
  "rel": "https://payid.org/ns/payid-discovery-url/1.0",
  "href": "https://delegate.example.com/.well-known/webfinger?resource=
           payid%3Aalice%24example.com"
}
</pre>
<h1 id="rfc.section.5.2">
<a href="#rfc.section.5.2">5.2.</a> <a href="#jrd-for-payid-uri-template" id="jrd-for-payid-uri-template">JRD for PayID URI Template</a>
</h1>
<p id="rfc.section.5.2.p.1">This type of JRD can be used to represent a URL that is a PayID URL Template.</p>
<p></p>

<ul>
<li>'rel': <samp>https://payid.org/ns/payid-uri-template/1.0</samp>
</li>
<li>'template': A PayID URI Template</li>
</ul>
<p id="rfc.section.5.2.p.3">The following is an example of a JRD that indicates a PayID URI Template:</p>
<pre>
{
  "rel": "https://payid.org/ns/payid-uri-template/1.0",
  "template": "https://example.com/{acctpart}"
}                
</pre>
<h1 id="rfc.section.6">
<a href="#rfc.section.6">6.</a> <a href="#security-considerations" id="security-considerations">Security Considerations</a>
</h1>
<p id="rfc.section.6.p.1">Various security considerations should be taken into account for PayID Discovery.</p>
<p id="rfc.section.6.p.2">Among other resource, consult section 9 of <a href="#RFC7033" class="xref">[RFC7033]</a> and section 7 of <a href="#RFC3986" class="xref">[RFC3986]</a> for important security considerations involved in PayID Discovery.</p>
<h1 id="rfc.section.6.1">
<a href="#rfc.section.6.1">6.1.</a> <a href="#hosted-payid-discovery-services" id="hosted-payid-discovery-services">Hosted PayID Discovery Services</a>
</h1>
<p id="rfc.section.6.1.p.1">As with most services provided on the Internet, it is possible for a domain owner to utilize "hosted" WebFinger services. Consult section 7 of <a href="#RFC7033" class="xref">[RFC7033]</a> for considerations that could apply to both "manual" and "interactive" PayID Discovery when hosted by a third-party.</p>
<h1 id="rfc.section.6.2">
<a href="#rfc.section.6.2">6.2.</a> <a href="#cross-origin-resource-sharing-cors" id="cross-origin-resource-sharing-cors">Cross-Origin Resource Sharing (CORS)</a>
</h1>
<p id="rfc.section.6.2.p.1">PayID Discovery resources might not be accessible from a web browser due to "Same-Origin" policies. See section 5 of <a href="#RFC7033" class="xref">[RFC7033]</a> for CORS considerations that apply to both "manual" and "interactive" PayID Discovery modes.</p>
<h1 id="rfc.section.6.3">
<a href="#rfc.section.6.3">6.3.</a> <a href="#access-control" id="access-control">Access Control</a>
</h1>
<p id="rfc.section.6.3.p.1">As with all web resources, access to the PayID Discovery resource could require authentication. See section 6 of <a href="#RFC7033" class="xref">[RFC7033]</a> for Access Control considerations that could apply to both "manual" and "interactive" PayID Discovery modes.</p>
<h1 id="rfc.section.7">
<a href="#rfc.section.7">7.</a> <a href="#iana-considerations" id="iana-considerations">IANA Considerations</a>
</h1>
<h1 id="rfc.section.7.1">
<a href="#rfc.section.7.1">7.1.</a> <a href="#new-link-relation-types" id="new-link-relation-types">New Link Relation Types</a>
</h1>
<p id="rfc.section.7.1.p.1">This document defines the following Link relation types per <a href="#RFC7033" class="xref">[RFC7033]</a>.  See section 3 for examples of each type of Link.</p>
<h1 id="rfc.section.7.1.1">
<a href="#rfc.section.7.1.1">7.1.1.</a> <a href="#payid-discovery-url" id="payid-discovery-url">PayID Discovery URL</a>
</h1>
<p></p>

<ul>
<li>Relation Type ('rel'): <samp>https://payid.org/ns/payid-discovery-url/1.0</samp>
</li>
<li>Media Type: <samp>application/jrd+json</samp>
</li>
<li>Description: PayID Discovery URL, version 1.0</li>
</ul>
<h1 id="rfc.section.7.1.2">
<a href="#rfc.section.7.1.2">7.1.2.</a> <a href="#payid-discovery-uri-template" id="payid-discovery-uri-template">PayID Discovery URI Template</a>
</h1>
<p></p>

<ul>
<li>Relation Type ('rel'): <samp>https://payid.org/ns/payid-uri-template/1.0</samp>
</li>
<li>Media Type: <samp>application/jrd+json</samp>
</li>
<li>Description: PayID Discovery URI Template, version 1.0</li>
</ul>
<h1 id="rfc.section.8">
<a href="#rfc.section.8">8.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a>
</h1>
<p id="rfc.section.8.p.1">This document was heavily influenced by, and builds upon, Webfinger <a href="#RFC7033" class="xref">[RFC7033]</a> (adapted for a payments use-case) as well as the supporting RFCs that it relies upon and that influenced it, especially <a href="#RFC5988" class="xref">[RFC5988]</a> and <a href="#RFC6415" class="xref">[RFC6415]</a>. The author would like to acknowledge the contributions of everyone who worked on those and any related specifications.</p>
<p id="rfc.section.8.p.2">In addition, the author would like to acknowledge everyone who provided feedback and use-cases for this derivative specification.</p>
<h1 id="rfc.references">
<a href="#rfc.references">9.</a> References</h1>
<h1 id="rfc.references.1">
<a href="#rfc.references.1">9.1.</a> Normative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="PAYID-URI">[PAYID-URI]</b></td>
<td class="top">
<a>Fuelling, D.</a>, "<a href="https://tbd.example.com/">The 'payid' URI Scheme</a>", n.d..</td>
</tr>
<tr>
<td class="reference"><b id="RFC2119">[RFC2119]</b></td>
<td class="top">
<a>Bradner, S.</a>, "<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
</tr>
<tr>
<td class="reference"><b id="RFC3986">[RFC3986]</b></td>
<td class="top">
<a>Berners-Lee, T.</a>, <a>Fielding, R.</a> and <a>L. Masinter</a>, "<a href="https://tools.ietf.org/html/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>", STD 66, RFC 3986, DOI 10.17487/RFC3986, January 2005.</td>
</tr>
<tr>
<td class="reference"><b id="RFC4627">[RFC4627]</b></td>
<td class="top">
<a>Crockford, D.</a>, "<a href="https://tools.ietf.org/html/rfc4627">The application/json Media Type for JavaScript Object Notation (JSON)</a>", RFC 4627, DOI 10.17487/RFC4627, July 2006.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6570">[RFC6570]</b></td>
<td class="top">
<a>Gregorio, J.</a>, <a>Fielding, R.</a>, <a>Hadley, M.</a>, <a>Nottingham, M.</a> and <a>D. Orchard</a>, "<a href="https://tools.ietf.org/html/rfc6570">URI Template</a>", RFC 6570, DOI 10.17487/RFC6570, March 2012.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7033">[RFC7033]</b></td>
<td class="top">
<a>Jones, P.</a>, <a>Salgueiro, G.</a>, <a>Jones, M.</a> and <a>J. Smarr</a>, "<a href="https://tools.ietf.org/html/rfc7033">WebFinger</a>", RFC 7033, DOI 10.17487/RFC7033, September 2013.</td>
</tr>
<tr>
<td class="reference"><b id="RFC7230">[RFC7230]</b></td>
<td class="top">
<a>Fielding, R.</a> and <a>J. Reschke</a>, "<a href="https://tools.ietf.org/html/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>", RFC 7230, DOI 10.17487/RFC7230, June 2014.</td>
</tr>
</tbody></table>
<h1 id="rfc.references.2">
<a href="#rfc.references.2">9.2.</a> Informative References</h1>
<table><tbody>
<tr>
<td class="reference"><b id="RFC5988">[RFC5988]</b></td>
<td class="top">
<a>Nottingham, M.</a>, "<a href="https://tools.ietf.org/html/rfc5988">Web Linking</a>", RFC 5988, DOI 10.17487/RFC5988, October 2010.</td>
</tr>
<tr>
<td class="reference"><b id="RFC6415">[RFC6415]</b></td>
<td class="top">
<a>Hammer-Lahav, E.</a> and <a>B. Cook</a>, "<a href="https://tools.ietf.org/html/rfc6415">Web Host Metadata</a>", RFC 6415, DOI 10.17487/RFC6415, October 2011.</td>
</tr>
</tbody></table>
<h1 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">David Fuelling</span> 
	  <span class="n hidden">
		<span class="family-name">Fuelling</span>
	  </span>
	</span>
	<span class="org vcardline">Ripple</span>
	<span class="adr">
	  <span class="vcardline">315 Montgomery Street</span>

	  <span class="vcardline">
		<span class="locality">San Francisco</span>,  
		<span class="region">CA</span> 
		<span class="code">94104</span>
	  </span>
	  <span class="country-name vcardline">US</span>
	</span>
	<span class="vcardline">Phone: -----------------</span>

<span class="vcardline">EMail: <a href="mailto:fuelling@ripple.com">fuelling@ripple.com</a></span>

<span class="vcardline">URI: <a href="https://www.ripple.com">https://www.ripple.com</a></span>

  </address>
</div>

</body>
</html>
